# py-psych-bot

## Инструкция

### Подготовка

На устройстве, где будет запускаться данный Telegram бот должен
быть установлен Python 3.12. [Скачать можно здесь](https://www.python.org/downloads)

Далее, находясь в папке репозитория, 
нужно ввести следующие команды:

```commandline
python -m venv venv
```
```commandline
venv/Scripts/activate
```
```commandline
pip install -r requirements.txt
```

Таким образом, вы создаете и активируете виртуальную среду
и устанавливаете в нее зависимости проекта.


### Как использовать

Прежде чем запускать бота необходимо настроить файл конфигурации под себя.
Файл конфигурации - это файл ``config.ini``. Напротив переменной
``token`` нужно через "=" написать уникальный токен телеграм бота,
выданного BotFather. Пример:
```ini
[Telegram]
token=<ВАШ ТОКЕН>
```

Далее нужно указать ключ OpenAI, это делается аналогично предыдущему
шагу. Пример:
```ini
[OpenAI]
api_key=<ВАШ КЛЮЧ>
```

Телеграм бот запускается командой:
```commandline
python main.py
```

Чтобы прекратить работу можно нажать Ctrl+C, 
если проект запущен из консоли. 

Все логи пишутся в консоль и в файл `log.txt`. Чтобы посмотреть
логи общения конкретного пользователя, создаются логи с именем типа
``{username}_log.txt``, где username - это ник пользователся Telegram
(тот который можно посмотреть в настройках и который обычно пишется
с @ в начале).

Стоит уточнить что файлы логов пишутся в кодировке `windows-1251`.

### Для разработчиков

Проект состоит из нескольких составляющих, которые представляют из
себя отдельные `*.py` файлы.

`main.py` - Главный файл, в котором происходит инициализация и
запуск бота.

`Logger.py` - файл, содержащий функции логирования.

`DataBase.py` - если вы не собираетесь использовать базы данных
в проекте, то по сути данный файл бесполезен. В нем содержаться
функции, выполняющие различные операции с БД для загрузки истории
сообщений и ее просмотра.

`MoralSchemeHandler.py` - по сути данный файл предоставляет
функцию типа `f(<сообщение>) -> ответ`. Самое главное в данном файле -
это функции `get_reply` и `just_use_unmoral_scheme`. Именно они
реализуют функцию "вопрос-ответ".

`Party.py` - файл, содержащий логику Telegram бота,
то есть то, как и на какие команды он реагирует, какие у него
состояния и т.д.


Далее стоит рассказать про остальные файлы проекты:

`database_scripts.sql` - Скрипт создания БД. Он НЕ НУЖЕН, 
если вы не собираетесь использовать базы данных.

`start_prompt.txt` - стартовый промпт для ChatGPT.
